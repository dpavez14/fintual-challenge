<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/Users/danielpavez/Documents/Portfolio/C#/Challenge.Tests/PortfolioTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using Xunit;
using Challenge;

namespace ChallengeTests;

public class PortfolioTests
{
    [Fact]
    public void AddStock_ShouldThrowArgumentOutOfRangeException_IfAddsANegativeAmount()
    {
        // Arrange
        decimal amount = -1;
        Portfolio portfolio = new Portfolio();
        Stock stock = new Stock(&quot;Fintual&quot;);

        // Act &amp; Assert
        Assert.Throws&lt;ArgumentOutOfRangeException&gt;(() =&gt; portfolio.AddStock(stock, amount));
    }
    
    [Fact]
    public void AddStock_ShouldThrowArgumentOutOfRangeException_IfAddsZeroAmount()
    {
        // Arrange
        decimal amount = 0;
        Portfolio portfolio = new Portfolio();
        Stock stock = new Stock(&quot;Fintual&quot;);

        // Act &amp; Assert
        Assert.Throws&lt;ArgumentOutOfRangeException&gt;(() =&gt; portfolio.AddStock(stock, amount));
    }
    
    [Fact]
    public void AddStock_ShouldAddAPositiveAmountOfAStockCorrectly()
    {
        // Arrange
        decimal amount = 1;
        Portfolio portfolio = new Portfolio();
        Stock stock = new Stock(&quot;Fintual&quot;);

        // Act
        decimal actual = portfolio.AddStock(stock, amount);
        
        // Assert
        Assert.Equal(amount, actual);
    }
    
    [Fact]
    public void AddStock_ShouldAddAPositiveAmountOfAStockMultipleTimesCorrectly()
    {
        // Arrange
        decimal amount1 = 1;
        decimal amount2 = 9;
        decimal expected = amount1 + amount2;
        
        Portfolio portfolio = new Portfolio();
        Stock stock = new Stock(&quot;Fintual&quot;);

        // Act
        portfolio.AddStock(stock, amount1);
        decimal actual = portfolio.AddStock(stock, amount2);
        
        // Assert
        Assert.Equal(expected, actual);
    }
    
    [Fact]
    public void Profit_CumulativeReturn_ShouldReturnZero_IfDontHaveStocks()
    {
        ShouldReturnZero_IfDontHaveStocks(false);
    }
    
    [Fact]
    public void Profit_AnnualizedReturn_ShouldReturnZero_IfDontHaveStocks()
    {
        ShouldReturnZero_IfDontHaveStocks(true);
    }
    
    private void ShouldReturnZero_IfDontHaveStocks(bool isAnnualized)
    {
        // Arrange
        const decimal expected = 0;
        Portfolio portfolio = new Portfolio();

        DateOnly start = DateOnly.FromDateTime(DateTime.Now);
        DateOnly end = start.AddYears(1);

        // Act
        decimal actual = portfolio.Profit(start, end, isAnnualized);

        // Assert
        Assert.Equal(expected, actual);
    }
    
    [Fact]
    public void Profit_CumulativeReturn_ShouldReturnZero_IfStartAndEndAreEquals()
    {
        ShouldReturnZero_IfStartAndEndAreEquals(false);
    }
    
    [Fact]
    public void Profit_AnnualizedReturn_ShouldReturnZero_IfStartAndEndAreEquals()
    {
        ShouldReturnZero_IfStartAndEndAreEquals(true);
    }
    
    private void ShouldReturnZero_IfStartAndEndAreEquals(bool isAnnualized)
    {
        // Arrange
        const decimal expected = 0;
        Portfolio portfolio = new Portfolio();

        DateOnly date = DateOnly.FromDateTime(DateTime.Now);
        
        Stock stock = new Stock(&quot;Fintual&quot;);
        stock.TryAddPrice(date, 50);
        
        portfolio.AddStock(stock, 100);

        // Act
        decimal actual = portfolio.Profit(date, date, isAnnualized);

        // Assert
        Assert.Equal(expected, actual);
    }

    [Fact]
    public void Profit_CumulativeReturn_ShouldThrowArgumentException_IfStartIsAfterEnd()
    {
        ShouldThrowArgumentException_IfStartIsAfterEnd(false);
    }
    
    [Fact]
    public void Profit_AnnualizedReturn_ShouldThrowArgumentException_IfStartIsAfterEnd()
    {
        ShouldThrowArgumentException_IfStartIsAfterEnd(true);
    }
    
    private void ShouldThrowArgumentException_IfStartIsAfterEnd(bool isAnnualized)
    {
        // Arrange
        Portfolio portfolio = new Portfolio();

        DateOnly start = DateOnly.FromDateTime(DateTime.Now);
        DateOnly end = start.AddYears(-1); // Before
        
        Stock stock = new Stock(&quot;Fintual&quot;);
        stock.TryAddPrice(start, 10);
        stock.TryAddPrice(end, 20);
        
        portfolio.AddStock(stock, 100);

        // Act &amp; assert
        Assert.Throws&lt;ArgumentException&gt;(() =&gt; portfolio.Profit(start, end, isAnnualized));
    }
    
    [Fact]
    public void Profit_CumulativeReturn_ShouldCalculateCorrectlyForOneStock()
    {
        // Arrange
        const decimal expected = 0.04m;
        Portfolio portfolio = new Portfolio();

        DateOnly start = DateOnly.FromDateTime(DateTime.Now);
        DateOnly end = start.AddYears(1);
        
        Stock stock = new Stock(&quot;Fintual&quot;);
        stock.TryAddPrice(start, 50);
        stock.TryAddPrice(end, 52);
        
        portfolio.AddStock(stock, 100);

        // Act
        decimal actual = portfolio.Profit(start, end, false);

        // Assert
        Assert.Equal(expected, actual);
    }
    
    [Fact]
    public void Profit_CumulativeReturn_ShouldCalculateCorrectlyForMultipleStocks()
    {
        // Arrange
        const decimal expected = 0.04m;
        Portfolio portfolio = new Portfolio();

        DateOnly start = DateOnly.FromDateTime(DateTime.Now);
        DateOnly end = start.AddYears(1);
        
        Stock stock1 = new Stock(&quot;Fintual 1&quot;);
        stock1.TryAddPrice(start, 7);
        stock1.TryAddPrice(end, 8);
        
        Stock stock2 = new Stock(&quot;Fintual 2&quot;);
        stock2.TryAddPrice(start, 11);
        stock2.TryAddPrice(end, 10);
        
        portfolio.AddStock(stock1, 4);
        portfolio.AddStock(stock2, 2);

        // Act
        decimal actual = portfolio.Profit(start, end, false);

        // Assert
        Assert.Equal(expected, actual);
    }
    
    [Fact]
    public void Profit_CumulativeReturn_ShouldCalculateCorrectlyForMultipleStocks2()
    {
        // Arrange
        const decimal expected = 0.05m;
        Portfolio portfolio = new Portfolio();

        DateOnly start = DateOnly.FromDateTime(DateTime.Now);
        DateOnly end = start.AddYears(1);
        
        Stock stock1 = new Stock(&quot;Fintual 1&quot;);
        stock1.TryAddPrice(start, 87);
        stock1.TryAddPrice(end, 29);
        
        Stock stock2 = new Stock(&quot;Fintual 2&quot;);
        stock2.TryAddPrice(start, 17);
        stock2.TryAddPrice(end, 20);
        
        portfolio.AddStock(stock1, 25);
        portfolio.AddStock(stock2, 725);

        // Act
        decimal actual = portfolio.Profit(start, end, false);

        // Assert
        Assert.Equal(expected, actual);
    }

    [Fact]
    void Profit_AnnualizedReturn_ShouldCalculateCorrectlyForYearlyPeriod()
    {
        // Arrange
        decimal expected = (decimal)Math.Pow(1.30903, 1.0/5.0) - 1m;
        Portfolio portfolio = new Portfolio();
        
        Stock stock = new Stock(&quot;Fintual&quot;);

        DateOnly start = DateOnly.FromDateTime(DateTime.Now);

        DateOnly end = start.AddYears(5).AddDays(-1);

        stock.TryAddPrice(start, 100);
        
        stock.TryAddPrice(end, 130.903m);
        
        portfolio.AddStock(stock, 1);

        // Act
        decimal actual = portfolio.Profit(start, end);
        
        // Assert
        Assert.Equal(expected, actual);
    }
    
    [Fact]
    void Profit_AnnualizedReturn_ShouldCalculateCorrectlyForNonYearlyPeriod()
    {
        // Arrange
        decimal expected = (decimal)Math.Pow(1.2374, 365.0 / 575.0) - 1m;
        Portfolio portfolio = new Portfolio();
        
        Stock stock = new Stock(&quot;Fintual&quot;);

        DateOnly start = DateOnly.FromDateTime(DateTime.Now);

        DateOnly end = start.AddDays(575);

        stock.TryAddPrice(start, 100);
        
        stock.TryAddPrice(end, 123.74m);
        
        portfolio.AddStock(stock, 1);

        // Act
        decimal actual = portfolio.Profit(start, end);
        
        // Assert
        Assert.Equal(expected, actual);
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[11,5,11,6,1],[13,9,13,29,1],[14,9,14,47,1],[15,9,15,44,1],[18,9,18,58,1],[18,58,18,91,1],[18,91,18,93,1],[19,5,19,6,1],[23,5,23,6,1],[25,9,25,28,1],[26,9,26,47,1],[27,9,27,44,1],[30,9,30,58,1],[30,58,30,91,1],[30,91,30,93,1],[31,5,31,6,1],[35,5,35,6,1],[37,9,37,28,1],[38,9,38,47,1],[39,9,39,44,1],[42,9,42,60,1],[45,9,45,38,1],[46,5,46,6,1],[50,5,50,6,1],[52,9,52,29,1],[53,9,53,29,1],[54,9,54,46,1],[56,9,56,47,1],[57,9,57,44,1],[60,9,60,44,1],[61,9,61,61,1],[64,9,64,40,1],[65,5,65,6,1],[69,5,69,6,1],[70,9,70,50,1],[71,5,71,6,1],[75,5,75,6,1],[76,9,76,49,1],[77,5,77,6,1],[80,5,80,6,1],[83,9,83,47,1],[85,9,85,62,1],[86,9,86,42,1],[89,9,89,69,1],[92,9,92,40,1],[93,5,93,6,1],[97,5,97,6,1],[98,9,98,56,1],[99,5,99,6,1],[103,5,103,6,1],[104,9,104,55,1],[105,5,105,6,1],[108,5,108,6,1],[111,9,111,47,1],[113,9,113,61,1],[115,9,115,44,1],[116,9,116,37,1],[118,9,118,40,1],[121,9,121,69,1],[124,9,124,40,1],[125,5,125,6,1],[129,5,129,6,1],[130,9,130,63,1],[131,5,131,6,1],[135,5,135,6,1],[136,9,136,62,1],[137,5,137,6,1],[140,5,140,6,1],[142,9,142,47,1],[144,9,144,62,1],[145,9,145,43,1],[147,9,147,44,1],[148,9,148,38,1],[149,9,149,36,1],[151,9,151,40,1],[154,9,154,48,1],[154,48,154,90,1],[154,90,154,92,1],[155,5,155,6,1],[159,5,159,6,1],[162,9,162,47,1],[164,9,164,62,1],[165,9,165,42,1],[167,9,167,44,1],[168,9,168,38,1],[169,9,169,36,1],[171,9,171,40,1],[174,9,174,62,1],[177,9,177,40,1],[178,5,178,6,1],[182,5,182,6,1],[185,9,185,47,1],[187,9,187,62,1],[188,9,188,42,1],[190,9,190,47,1],[191,9,191,38,1],[192,9,192,36,1],[194,9,194,47,1],[195,9,195,39,1],[196,9,196,37,1],[198,9,198,39,1],[199,9,199,39,1],[202,9,202,62,1],[205,9,205,40,1],[206,5,206,6,1],[210,5,210,6,1],[213,9,213,47,1],[215,9,215,62,1],[216,9,216,42,1],[218,9,218,47,1],[219,9,219,39,1],[220,9,220,37,1],[222,9,222,47,1],[223,9,223,39,1],[224,9,224,37,1],[226,9,226,40,1],[227,9,227,41,1],[230,9,230,62,1],[233,9,233,40,1],[234,5,234,6,1],[238,5,238,6,1],[240,9,240,69,1],[241,9,241,47,1],[243,9,243,44,1],[245,9,245,62,1],[247,9,247,54,1],[249,9,249,39,1],[251,9,251,42,1],[253,9,253,38,1],[256,9,256,55,1],[259,9,259,40,1],[260,5,260,6,1],[264,5,264,6,1],[266,9,266,74,1],[267,9,267,47,1],[269,9,269,44,1],[271,9,271,62,1],[273,9,273,43,1],[275,9,275,39,1],[277,9,277,41,1],[279,9,279,38,1],[282,9,282,55,1],[285,9,285,40,1],[286,5,286,6,1]]);
    </script>
  </body>
</html>